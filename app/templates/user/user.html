{% extends "base.html" %}

{% block title %}<title>Video annotation - User</title>{% endblock %}

{% block head_extension %}
<script type="text/javascript"
        src="https://player.vimeo.com/api/player.js"></script>
<script type="text/javascript"
        src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script type="text/javascript"
        src="{{ url_for('static', filename='js/slider.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='slider.css') }}">
<script type="text/javascript" src="jquery.js"></script>
<link rel="stylesheet" href="jquery.range2dslider.css">
<script type="text/javascript" src="jquery.range2dslider.js"></script>

<style>
  #button-1 {
  /* default for <button>, but useful for <a> */
  display: inline-block;
  text-align: center;
  text-decoration: none;
  font-family: : -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";

  /* create a small space when buttons wrap on 2 lines */
  margin: 2px 0;

  /* invisible border (will be colored on hover/focus) */
  border: solid 2px transparent;
  border-radius: 4px;

  /* size comes from text & padding (no width/height) */
  padding: 0.5em 1em;

  /* make sure colors have enough contrast! */
  color: #ffffff;
  background-color: #343A40;
}
</style>

<style>
  #slider
  body,html{
    margin:0px;
    padding:0px;
  }
  ul{
    margin:0px 0px;
    padding:20px 25px;
  }
  body>div{
    margin:0px 20px;
    padding:20px;
    background:rgba(184, 184, 184, 0.1);
  }
</style>
{% endblock %}


{% block navbar_extension %}
<div class="collapse navbar-collapse justify-content-end"
     id="navbarMain">
    <div class="navbar-nav">
        <a class="nav-item nav-link"
           href="{{ url_for('control.choose_role') }}">Change role</a>
    </div>
</div>
{% endblock %}


{% set vimeoId = '65107797' %}

{% block main_body %}

<div class="container text-muted">
    Please watch the video and, at the same time, move the slider up or down
    when it makes you feel good or bad.
    <p></p>
</div>

<div class="container">
    <div class="row align-items-center">
        <div>
            <div data-vimeo-id="{{ vimeoId }}"
                 data-vimeo-width="800"
                 id="player"></div>
        </div>
        <div>
            <div id="buttonContainer" style="position:relative;bottom:50px;margin-right:20px;margin-left:20px">
                <button id="button-1">Press here</button>
            </div>
            <!-- <form id="slider-1" style="width:220%;transform:rotate(270deg)">
                <input type="range" class="custom-range"
                       id="formControlRange" min="0" max="100" step="1"
                       value="50" name="value"
                       ondrag="slider_value.innerHTML = this.value;"
                       onchange="player.getCurrentTime().then(timestamp =>
                                {sendData(timestamp, this.value, {{ vimeoId }})});
                                slider_value.innerHTML = this.value;">
            </form> -->

          </div>
          <div id="slider_value" class="align-self-end"
               style="position:relative;bottom:30px">
          </div>
          <form id="slider-2" style="position:relative;bottom:425px;margin-right:10px;margin-left:1020px">
            <div class="wrapper">
              <div class="rangepresenter">
                <div class="rangepresenter verticalsliders">
                    <div class="rangewrapper vertical">
                        <div class="sliderfill">

                      <input class="customrange" type="range" min="0" max="100" value="50" name="value"
                      ondrag="slider_value.innerHTML = this.value;"
                      onchange="player.getCurrentTime().then(timestamp =>
                               {sendData(timestamp, this.value, {{ vimeoId }})});
                               slider_value.innerHTML = this.value;">
                        </div>
                    <div class="sliderthumb"></div>
                    <div class="slidervalue"></div>
                </div>
              </div>
            </div>

        </div>
        </form>
        <div id="slider_value" class="align-self-end"
             style="position:relative;bottom:10px">
        </div>
    </div>
</div>




<input id="slider">
<script>
window.onerror = function(msg, url, linenumber) {
      alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber);
      return true;
  }
$('#slider').range2DSlider({
  grid:false,
  axis:[[0,25,50,75,100],[0,25,50,75,100]],
  projections:true,
  showLegend:[1,1],
  allowAxisMove:['both'],
  printLabel:function( val ){
    this.projections&&this.projections[0].find('.xdsoft_projection_value_x').text(val[1].toFixed(5));
    return val[0].toFixed(5);
  }
})
  .range2DSlider('value',[[50,50]]);

$('#slider')
  .range2DSlider();
</script>

<script>
    var player = new Vimeo.Player('player');
    player.on('play', function () {
      console.log('The video is playing, yay!');
    });
</script>

<script>
    let ticks = 0;
    let clock;
    let time;
    let button = document.getElementById('button-1');
    button.addEventListener("mousedown", event => {
        if(event.button == 0){
            player.getCurrentTime().then(timestamp => {
                time = timestamp;
            });
            clock = setInterval(() => {
                if(ticks < 100){
                    ticks++;
                    updateSlider(0, ticks);
                }
                slider_value.innerHTML = ticks;
            }, 10);
 /*           setTimeout(() => {
                console.log("TIMEOUT", ticks);
            }, 1600); */
        }
    });
    button.addEventListener("mouseup", event => {
        if(event.button == 0){
                sendData(time, ticks, {{ vimeoId }})
                clearInterval(clock);
                ticks = 0;
        }
    });
</script>
{% endblock %}
